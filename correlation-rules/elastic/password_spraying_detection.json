{
    "name": "Password Spraying Detection",
    "description": "Detects low-and-slow password spraying attacks where one password is tried against many accounts. Maps to MITRE ATT&CK T1110.003.",
    "risk_score": 63,
    "severity": "high",
    "type": "threshold",
    "query": "event.code:\"4625\" and not user.name:(svc* or *$ or SYSTEM or \"NETWORK SERVICE\" or \"LOCAL SERVICE\")",
    "language": "kuery",
    "index": [
        "winlogbeat-*",
        "logs-windows.*"
    ],
    "filters": [],
    "from": "now-1h",
    "interval": "30m",
    "max_signals": 50,
    "threshold": {
        "field": [
            "source.ip"
        ],
        "value": 10,
        "cardinality": [
            {
                "field": "user.name",
                "value": 10
            }
        ]
    },
    "threat": [
        {
            "framework": "MITRE ATT&CK",
            "tactic": {
                "id": "TA0006",
                "name": "Credential Access",
                "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
                {
                    "id": "T1110",
                    "name": "Brute Force",
                    "reference": "https://attack.mitre.org/techniques/T1110/",
                    "subtechnique": [
                        {
                            "id": "T1110.003",
                            "name": "Password Spraying",
                            "reference": "https://attack.mitre.org/techniques/T1110/003/"
                        }
                    ]
                }
            ]
        }
    ],
    "rule_id": "soc-password-spraying-001",
    "version": 1,
    "author": [
        "SOC Team"
    ],
    "license": "MIT",
    "tags": [
        "Password Spraying",
        "Credential Access",
        "Windows Security",
        "T1110.003",
        "Low-and-Slow"
    ],
    "references": [
        "https://attack.mitre.org/techniques/T1110/003/",
        "https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4625"
    ],
    "note": "Password Spraying Detection: Triggers when a single source IP targets 10+ unique accounts. This indicates attacker trying one password against many accounts to avoid lockout thresholds. Differentiated from brute force by low per-account failure count.",
    "false_positives": [
        "Legitimate security scanning tools",
        "Misconfigured applications cycling through service accounts",
        "Penetration testing activities"
    ],
    "investigation_guide": "## Investigation Steps\n1. Verify source IP is not an authorized scanner\n2. Check if accounts targeted share common attributes (same department, naming convention)\n3. Review any successful logins from the source IP\n4. Check for lateral movement post-spray\n5. Consider temporary IP block pending investigation",
    "required_fields": [
        {
            "name": "event.code",
            "type": "keyword"
        },
        {
            "name": "user.name",
            "type": "keyword"
        },
        {
            "name": "source.ip",
            "type": "ip"
        }
    ],
    "setup": "## Setup\nEnsure Windows Security logs are forwarded via Winlogbeat or Elastic Agent. The threshold is set to 10 unique accounts from a single IP in 1 hour - adjust based on your environment baseline."
}